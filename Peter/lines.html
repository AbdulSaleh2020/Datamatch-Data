<!DOCTYPE html>
<svg width="960" height="500"></svg>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var total_people = 1;
var times_array;
var boys_array;
var girls_array;

var parseTime = d3.timeParse("%d-%b-%y");

var x = d3.scaleTime()
    .rangeRound([0, width]);

var y = d3.scaleLinear()
    .rangeRound([height, 0]);

var line = d3.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.response); });

function randomDate(start, end) {
    return new Date(start.getTime() + Math.random()*(end.getTime() - start.getTime()));
}

d3.json("times.json", function(d) {
  console.log(d.times);
  times_array = d.times
  times_array = times_array;
  times_array
  .forEach(function(d) {
      if (d.signup_time == null) {
        // thing = new Date(Date.parse("2016-02-09T07:31:30.000Z"));
        d.date = randomDate(new Date(Date.parse("2016-02-07T07:31:30.000Z")), new Date(Date.parse("2017-01-30T05:30:49.000Z")))
      } 
      else {
        d.date = new Date(Date.parse(d.signup_time));
      }
  })
  times_array.sort(function (a,b) {return (new Date(a.date) - new Date(b.date))})
  times_array.forEach(function(d){
      d.response = total_people
      total_people +=1

  })
      x.domain(d3.extent(times_array, function(d) { return d.date; }));

      y.domain(d3.extent(times_array, function(d) { return d.response; }));

//This must go before filtering by gender etc because when we change d.response it modifies things here.  
console.log(line);
  g.append("path")
    .datum(times_array)
    .attr("d", line)
    .attr("fill", "none")
    .attr("stroke", "steelblue")
    .attr("stroke-linejoin", "round")
    .attr("stroke-linecap", "round")
    .attr("stroke-width", 1.5)
    .style("stroke-width", "2.5px")
    .on("mouseover", function (d) {                                  
      d3.select(this)                        
      .style("stroke-width",'6px')
      })
    .on("mouseout", function(d) {   
      d3.select(this)
      .style("stroke-width",'2.5px')});

//Girls Array Stuff
  girls_array = times_array
  girls_array = girls_array.filter(function(n){return (n.gender=="Female");})
  var total_girls = 1;
  girls_array.forEach(function(d){
    d.response = total_girls
    total_girls += 1;
    })

  g.append("g")
      .call(d3.axisLeft(y))
    .append("text")
      .attr("fill", "#000")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .attr("text-anchor", "end")
      .text("Number of People Signed Up");

  g.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x))
      .append("text")
        .text("Date")
        .attr("fill", "#000")
        .attr("x", 6)
        .attr("dy", "0.71em")
        .attr("text-anchor", "end")
    .select(".domain")
      .remove();




  


g.append("path")
    .datum(girls_array)
    .attr("d", line)
    .attr("fill", "none")
    .attr("stroke", "steelblue")
    .attr("stroke-linejoin", "round")
    .attr("stroke-linecap", "round")
    .attr("stroke-width", 1.5)
    .style("stroke-width", "2.5px")
    .on("mouseover", function (d) {                                  
      d3.select(this)                          //on mouseover of each line, give it a nice thick stroke
      .style("stroke-width",'6px')
      })
    .on("mouseout", function(d) {        //undo everything on the mouseout
      d3.select(this)
      .style("stroke-width",'2.5px')});
  })



</script>