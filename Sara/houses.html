<!DOCTYPE html>
<!-- Specify character encoding for the HTML document -->
<meta charset="utf-8">

	<!-- CSS/style -->
    <style>

        .button {
            display: inline-block;
            padding: .8em;
            background-color: #B7B7B7;
            text-decoration: none;
            color: white;
        }
        
        .hvr-fade {
            display: inline-block;
            vertical-align: middle;
            -webkit-transform: perspective(1px) translateZ(0);
            transform: perspective(1px) translateZ(0);
            box-shadow: 0 0 1px transparent;
            overflow: hidden;
            -webkit-transition-duration: 0.3s;
            transition-duration: 0.3s;
            -webkit-transition-property: color, background-color;
            transition-property: color, background-color;
        }

        svg {
            position: relative;
            z-index:0;
        }
        
        .hvr-fade:hover, .hvr-fade:focus, .hvr-fade:active {
            background-color: #9B1B00;
            color: white;
        }

        #chart-container {
            height: 500px;
            position: relative;
            z-index: 0;
            width: 960px; 
            margin-bottom: 20px;
        }

        #button-container {
            position: relative;
            width: 960px; 

        }

        .tooltip {
            background: #eee;
            box-shadow: 0 0 5px #999999;
            color: #333;
            display: none;
            font-size: 12px;
            left: 240px;                             
            padding: 10px;
            position: absolute;
            text-align: center;
            top: 220px;                                             
            width: 80px;
            z-index: 10;                                                
        } 

        #my-wrapper {
            position:relative; 
            padding-top: 15px;
        }

        #title {
            font-family: 'Sintony', sans-serif;
            font-size: 40px;
            text-align: center;
            margin-top: 35px;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            margin: auto;
            position: relative;
            width: 960px;
        }
    
        text{
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font: 11px sans-serif;
        }
    
        form {
            position: absolute;
            right: 10px;
            top: 10px;
        }

        .selected {
            background-color: #9B1B00;
        }

    </style>

    <head>

        <link href="https://fonts.googleapis.com/css?family=Sintony:700" rel="stylesheet">
        <title>

         House Compatibility

        </title>

    </head>
    <body style="background-color: #E7E7E7;">
    <div id="title">House Compatibility</div>
    <div id="my-wrapper">

    <div style="float:left;" id="chart-container"></div>

    <div id="button-container">
    </div>

        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Adams">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Cabot">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Currier">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Dunster">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Leverett">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Eliot">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Kirkland">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Lowell">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Mather">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Pforzheimer">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Quincy">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Winthrop">
        <input class="filter-button button hvr-fade" type="button" name="dataset" value="Freshmen">
        
    </div>
    </body>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script>
    	
        var width = 960,
        height = 500,
        radius = Math.min(width, height) / 2;
        var legendRectSize = 20;
        var legendSpacing = 4;

        var enterClockwise = {
            startAngle: 0,
            endAngle: 0
        };

        var enterAntiClockwise = {
            startAngle: Math.PI * 2,
            endAngle: Math.PI * 2
        };


        
        var color = d3.scaleOrdinal()
            .domain([])
            .range(["#A80022", "#D8ADB6", "#F27991", "#992233", "#FFCCD6", "#881133", "#AA8888", "#DF2047", "#FF99AE", "#A3465C", "#881122", "#660011", "#C5677B"]);

        var pie = d3.pie()
            .sort(null)
       
        var arc = d3.arc()
            .innerRadius(radius - 100)
            .outerRadius(radius - 20)
            

        var tooltip = d3.select('#chart')                               
          .append('div')                                                
          .attr('class', 'tooltip'); 

        tooltip.append('div')                                           
          .attr('class', 'label'); 
        
        var svg = d3.select("#chart-container")
        	.append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", function(d){
            		return "translate(" + width / 2 + "," + height / 2 + ")";
        	})
        	
        
        d3.csv("matchmatrix.csv", type, function(error, data) {
            var path = svg.datum(data).selectAll("path")
                .data(pie)
                .enter()
                .append("path")
                .attr("fill", function(d, i) 
                {
                    return color(i); 
                })
                /*.attr("d", arc(enterClockwise))*/
                .each(function(d) { 
                    this._current = {
                        data: d.data,
                        value: d.value,
                        startAngle: enterClockwise.startAngle,
                        endAngle: enterClockwise.endAngle
                    };
                });                 

            

            d3.selectAll("input.filter-button").on('click', function(){
                var value = this.value;
                pie.value(function(d) { 
                    return d[value]; 
                }); // change the value function
                path = path.data(pie); // compute the new angles
                path.transition().duration(750).attrTween("d",arcTween); // redraw the arcs
            
                d3.selectAll("input.filter-button").classed("selected", false)
                d3.select(this).classed("selected", true);
            });

            var legend = svg.selectAll('.legend')
                .data(["Leverett", "Kirkland", "Cabot", "Lowell", "Adams", "Dunster", "Mather", "Winthrop", "Pforzheimer", "Currier", "Quincy", "Eliot", "Freshmen"])
                .enter()
                .append('g')
                .attr('class', 'legend')
                 .attr('transform', function(d, i) {
                    var height = legendRectSize + legendSpacing;
                    var offset =  height * color.domain().length / 2.4;
                    var horz = -370;
                    var vert = i * height - offset;
                    return 'translate(' + horz + ',' + vert + ')';
                });

            legend.append('rect')
                .attr('width', legendRectSize)
                .attr('height', legendRectSize)
                .style('fill', color)
                .style('stroke', color);
            legend.append('text')
                .attr('x', legendRectSize + legendSpacing)
                .attr('y', legendRectSize - legendSpacing)
                .text(function(d) { return d; });

                path.on('mouseover', function(d) {
               d3.select("g").append("text")
               .attr("id", "myText")
                .text(d.value);
            });
        
            path.on('mouseout', function(d) { 
               d3.selectAll("#myText").remove()
                // tooltip.style('display', 'none');
               });

            path.exit()
                .transition()
                .duration(750)
                .attrTween('d', arcTweenOut)
                .remove() // now remove the exiting arcs
        });

               
        function type(d) {
            d.Leverett = +d.Leverett;
            d.Quincy = +d.Quincy;
            d.Kirkland = +d.Kirkland;
            d.Currier = +d.Currier;
            d.Winthrop = +d.Winthrop;
            d.Freshmen = +d.Freshmen;
            d.Cabot = +d.Cabot;
            d.Pforzheimer = +d.Pforzheimer;
            d.Adams = +d.Adams;
            d.Eliot = +d.Eliot;
            d.Dunster = +d.Dunster;
            d.Mather = +d.Mather;
            d.Lowell = +d.Lowell;
            return d;
        }


        // Store the displayed angles in _current.
        // Then, interpolate from _current to the new angles.
        // During the transition, _current is updated in-place by d3.interpolate.
        function arcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function(t) {
                return arc(i(t));
            };
        }
    
        // Interpolate exiting arcs start and end angles to Math.PI * 2
        // so that they 'exit' at the end of the data
        function arcTweenOut(a) {
            var i = d3.interpolate(this._current, {startAngle: Math.PI * 2, endAngle: Math.PI * 2, value: 0});
            this._current = i(0);
            return function (t) {
                return arc(i(t));
            };
        }



        </script>
